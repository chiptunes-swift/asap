prefix = @prefix@
exec_prefix = @exec_prefix@

CC = @CC@
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@

CFLAGS = @CFLAGS@
LDFLAGS = @LDFLAGS@
DEFS = @DEFS@ -DASAP -DSOUND
LIBS = @LIBS@
ASAP2WAV = asap2wav@EXEEXT@

ATARI800_SRC_DIR = ../atari800/src
SRC = asap.c $(ATARI800_SRC_DIR)/cpu.c $(ATARI800_SRC_DIR)/mzpokeysnd.c $(ATARI800_SRC_DIR)/pokeysnd.c $(ATARI800_SRC_DIR)/remez.c

all: $(ASAP2WAV) libasap.so

$(ASAP2WAV): asap2wav.c $(SRC) players.h
	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(DEFS) -I. -I$(ATARI800_SRC_DIR) asap2wav.c $(SRC) $(LIBS)

libasap.so: xmms/libasap.c $(SRC) players.h
	$(CC) $(CFLAGS) -I/usr/include/glib-1.2 -I/usr/lib/glib/include -I/usr/include/gtk-1.2 $(LDFLAGS) -shared -fPIC -o $@ $(DEFS) -I. -I$(ATARI800_SRC_DIR) xmms/libasap.c $(SRC) $(LIBS) -lpthread -lxmms

players.h: raw2c.pl players/cmc.obx players/mpt.obx players/rmt4.obx players/rmt8.obx players/tmc.obx
	perl $^ >$@

players/cmc.obx: players/cmc.asx
	xasm -q -o $@ $<

players/mpt.obx: players/mpt.asx
	xasm -q -o $@ $<

players/rmt4.obx: players/rmt.asx
	xasm -q -d STEREOMODE=0 -o $@ $<

players/rmt8.obx: players/rmt.asx
	xasm -q -d STEREOMODE=1 -o $@ $<

players/tmc.obx: players/tmc.asx
	xasm -q -o $@ $<

install: $(ASAP2WAV) asap2wav.1
	$(INSTALL_PROGRAM) $(ASAP2WAV) @bindir@/$(ASAP2WAV)
	$(INSTALL_DATA) asap2wav.1 @mandir@/man1/asap2wav.1

uninstall:
	rm @bindir@/$(ASAP2WAV)
	rm @mandir@/man1/asap2wav.1

clean:
	rm -f players.h $(ASAP2WAV) libasap.so core *.bak *~

distclean: clean
	-rm -f Makefile config.log config.status config.h configure config.h.in
	-rm -rf autom4te.cache
